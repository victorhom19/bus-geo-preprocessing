# Модуль предобработки картографических данных
Данный репозиторий содержит код проекта по разработке модуля предобработки картографических данных для
дискретно-событийной модели движения общественного транспорта.

## Возможности
**Функциональные блоки**
* Маршруты и остановки – добавление, сохранение, удаление данных об автобусных остановках и маршрутах 
(на основе интерфейса OverpassAPI)
* Загруженность дорог – расчет средней скорости движения транспорта на отдельных сегментов выбранных маршрутов
* Кластеризация остановок – объединение остановок в группы для упрощения работы с матрицой транспортных корреспонденций

**Интерфейсы**
* API – интерфейс для взаимодействия с внешними программными системами
* Инструмент визуализации – графический интерфейс в виде веб-приложения для пользователя

## Структура проекта

```text
.
├── app                         // Модуль предобработки картографических данных
│   │
│   ├── api
│   │   ├── api_schemas.py      // Схемы запросов и ответов API
│   │   └── router              // Описание конечных точек
│   │
│   ├── database
│   │   ├── alembic             // Файлы миграций БД
│   │   ├── daos                // Обертки объектов для взаимодействия с БД
│   │   ├── models              // Описания таблиц БД
│   │   └── database.py
│   │
│   ├── dispatcher
│   │   └── dispatcher.py       // Функции узла диспетчеризации 
│   │
│   ├── schemas
│   │   └── ...                 // Pydantic-схемы основных сущностей
│   │
│   ├── services
│   │   ├── bus_data             
│   │   │   └── ...             // Блок получения данных остановок и маршрутов
│   │   ├── stops_clustering
│   │   │   └── ...             // Блок кластеризации остановок
│   │   └── traffic_flow
│   │       └── ...             // Блок получения данных о загруженности дорог
│   │
│   ├── common_types.py         // Общие типы данных
│   ├── logger.py               // Логирование
│   ├── main.py                 // Основной файл для запуска системы
│   └── utils.py                // Общие вспомогательные функции
│
├── visualization_tool          // Инструмент визуализации картографических данных
│   │
│   ├── src
│   │   ├── api                 // Функции запросов к API модуля предобработки
│   │   ├── components          // React-компоненты интерфейса
│   │   └── store               // Описание глобального хранилища данных
│   └──...
│
├── tests                       // Файлы тестов
│
├── alembic.ini                 // Файл конфигурации миграций БД
├── config.py                   // Файл конфигурации модуля предобработки
├── docker-compose.yaml         // Файл конфигурации docker-compose для контейнеризации системы
├── pyproject.toml              // Файл конфигурации проекта Poetry
├── README.md 
│
└── ...
```

## Требования
* Python >= 3.10
* Poetry >= 2.0.1
* Docker + Docker Compose (для запуска контейнеров)
* Node >= 22.13 (если необходимо локально запустить инструмент визуализации)

## Установка
Клонирование репозитория:
```commandline
git clone https://github.com/victorhom19/bus-geo-preprocessing.git
```
Установка зависимостей модуля предобработки (для локального использования):
```commandline
cd bus-geo-preprocessing
poetry install
```

Установка зависимостей инструмента визуализации (для локального использования):
```commandline
cd visualization_tool
npm install
```

## Запуск

По умолчанию для API модуля предобработки картографических данных используется порт 8000, а для инструмента визуализации
– 8080.

### Локально

1. Создать локальную базу данных (PostgreSQL)
2. Сконфигурировать переменные окружения (см. config.py)
3. Запуск модуля предобработки:
```commandline
uvicorn app.main:app
```
4. Запуск инструмента визуализации:
```commandline
cd visualization_tool
npm run dev
```

### Docker Compose

* Развернуть контейнеры (со сборкой):
```commandline
docker-compose up --build
```

* Развернуть контейнеры (без сборки):
```commandline
docker-compose up
```

* Развернуть контейнеры (без инструмента визуализации):
```commandline
docker-compose up db app
```